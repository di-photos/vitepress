# 外网访问家中群晖-Tailscale篇

## 一、Tailscale 与群晖的奇妙组合

### （一）Tailscale 的特点与优势

1. Tailscale 作为一款强大的虚拟组网工具，具有诸多显著特点和优势。首先，基于 WireGuard 的它能够高效地加密数据传输，确保网络通信的安全性。据统计，Tailscale 使用的加密算法能够抵御绝大多数的网络攻击，为用户的数据提供坚实的保护。

2. 其跨运营商设备互访稳定性较好，无论用户使用的是移动、联通还是电信等不同运营商的网络，都能较为顺畅地实现设备之间的连接。

3. Tailscale 的客户端开源也是一大优势。这意味着开发者和用户可以根据自己的需求对客户端进行定制和优化，同时也促进了社区的发展，为用户提供了更多的技术支持和解决方案。

### （二）群晖在其中的作用

1. 在远程访问方面，用户可以随时随地通过安装了 Tailscale 的设备访问群晖中的文件，摆脱了传统网络环境的限制。**无论是在外出差还是在办公室，都能像在本地局域网一样方便地访问群晖中的照片、文档、视频等各种文件。**
2. 通过 Tailscale 的虚拟局域网，用户可以轻松实现多设备之间的**文件同步**，确保重要文件在不同设备上的一致性。同时，群晖的**备份**功能也能为用户的数据提供额外的保障，防止数据丢失。
3. 通过安装 Tailscale 套件，群晖成为虚拟局域网中的重要**接入网关**，为用户远程访问其他设备提供了便利。

## 二、使用 Tailscale 访问群晖的步骤

### （一）注册与准备工作

1. 国内用户首先需要注册一个微软的 outlook 邮箱，可前往 [outlook.com](https://outlook.com) 官网进行注册。

2. 注册完成后，打开 Tailscale 官方网站 [Tailscale.com](https://Tailscale.com)，点击 “Get started” 。

3. 选择中间的微软账号登录，使用注册好的 outlook 邮箱进行登录。

4. 登录到 tailscale 后，未添加设备的情况下，会看到没有任何设备列表（图中显示我的账号已经添加了3个设备）。


### （二）群晖 NAS 安装 Tailscale 套件

1. 进入群晖后台，打开套件中心，在所有套件栏搜索“Tailscale”，按提示进行安装，一路点击 “下一步” 即可安装完成。
2. 最新的[pkgs.tailscale.com/stable/#spks](https://pkgs.tailscale.com/stable/#spks)

安装套件完成后，直接在套件中心打开 Tailscale，会自动跳转到登录页面。和网页端登录相同，选择自己微软邮箱账号登录即可。登录后可以看到有个设备名称已经显示出来，这个就是 NAS 的设备名称。后面的 100 开头的 IP 地址即是 NAS 主机的虚拟网络的 IP。但此时还不能直接使用 ip:5000 进行访问，因为要访问 nas 主机的电脑还没安装 tailscale 的客户端。

### （三）电脑端安装 Tailscale 软件

在 tailscale 的官网有各类平台的客户端下载，如电脑是 win10 系统，可下载 windows 软件安装。下载 windows 客户端安装后提示登录，登录后可以看到本机名称及虚拟 IP 地址。这时在 Tailscale 的网页端点击左上角自己的邮箱用户名，就可以看到 nas 和 pc 设备以及对应的 ip 地址。

### （四）手机端访问 NAS 主机

下载 Tailscale 的安卓 app 并安装。（苹果手机应用商城要非国区的 ID 才可以下载）。以安卓手机为例，安装好后，打开直接提示登录，点进去提示登录操作和 pc 操作一样，选择微软账号 outlook 邮箱登录即可。成功登录后手机会提示信任来源，确定即可。这时会进入 tailscale 的设备列表，可以看到使用同一账号登录的不同设备，下方的 linux 设备就是 nas 主机的虚拟 IP。复制 nas 的虚拟 ip 到浏览器 app，IP:5000 就可以直接访问 nas 主机。其它群晖官方 app 登录管理 nas 主机的话，只要地址使用以上虚拟 IP 地址，即可登录使用。

## 三、Tailscale 的高级功能与设置



### （一）子网路由设置

子网路由的字面意思是子网路由，以前也被称为 relay node 或者 relaynode。其作用是充当网关，将流量从 Tailscale 网络中继到物理子网。例如，当我们有一些使用不运行外部软件的嵌入式设备，如打印机、普通路由器、玩客云等，不能给每台设备都安装 Tailscale 时，就可以设置一个子网路由来实现从 Tailscale 访问这些设备。

通过群晖设置子网路由的步骤如下：首先，用 SSH 客户端登录到群晖，在命令行中输入sudo tailscale up --advertise-routes [192.168.0.0/24](http://192.168.0.0/24) --advertise-exit-node --reset（如果是多个网段，用逗号隔离）。然后，进入管理控制台，即https://login.tailscale.com/admin/machines，找到安装了 Tailscale 的群晖主机，进入Edit route settings，可以看到我们命令行中设置的局域网地址段。启用局域网 IP，现在在其他设备上，就可以直接输入局域网中的设备 IP 进行访问了。比如在公司的办公机上，直接输入 [192.168.0.xxx](http://192.168.0.xxx) 就可以访问家里的设备了。

### （二）出口节点设置

出口节点功能允许您通过网络上的特定设备路由所有非 Tailscale 互联网流量，这台特定的路由设备称为出口节点。在 Wi-Fi 不受信任的咖啡馆中，或者在出国旅行时需要访问仅在本国可用的在线服务（例如银行业务）时，我们可能需要另一台安装了 Tailscale 客户端的设备路由所有公共互联网流量。

以群晖作为出口节点的设置方法如下：群晖端的命令在设置子网路由时已经合并处理过参数--advertise-exit-node，所以不需要再执行了。只要进控制台启用即可。接下来要设置使用出口节点的设备，比如办公机。出于安全目的，每个设备都必须明确选择使用出口节点，MacOS 和 Windows 上比较简单，菜单中可以找到 Exit Node，默认是 None，选择为被设为 Exit Node 的设备（如群晖设备）就可以了。这个时候 Tailscale 客户端的图标会多一个箭头。验证是否生效可以通过验证公网 IP，比如通过https://www.whatismyip.com这个网站，当选择不同的出口节点时，公网 IP 会发生变化，选择了群晖作为出口节点后，公网 IP 和在家里局域网中是一样的，这就说明设置成功了。

## 四、总结与展望



Tailscale 与群晖的结合为用户带来了极大的便利，无论是远程访问还是文件管理方面都展现出了强大的优势。

在远程访问方面，Tailscale 打破了传统网络的限制，让用户可以在任何有网络的地方轻松连接到群晖，实现对工作文件和重要数据的随时调用。这种便捷性使得用户不再依赖移动硬盘和 U 盘等不稳定的存储介质，大大提高了工作效率。例如，一位经常出差的商务人士，通过 Tailscale 可以在旅途中随时访问群晖中的文件，及时处理工作事务，避免了因重要文件未携带而影响工作进展的情况。

在文件管理方面，Tailscale 实现了多设备之间的高效同步。用户可以在办公室、家中等不同场所的设备上同步文件，确保数据的一致性。同时，群晖的备份功能也为用户的数据提供了可靠的保障，即使某个设备突然损坏，所有文件也已经热同步进了群晖，用户无需担心数据丢失。

展望未来，随着科技的不断发展，Tailscale 和群晖的应用前景将更加广阔。一方面，随着网络速度的不断提升和加密技术的进一步完善，远程访问和文件同步的速度将更快、更安全。另一方面，随着物联网技术的发展，更多的设备将可以通过 Tailscale 连接到群晖，实现智能化的文件管理和数据共享。例如，智能家居设备可以将数据备份到群晖，用户可以通过手机远程访问和控制这些设备，实现更加便捷的生活方式。

总之，Tailscale 连接群晖为用户带来了全新的网络体验，其在远程访问和文件管理方面的优势将继续发挥重要作用。相信在未来，随着技术的不断进步，Tailscale 和群晖的结合将为用户带来更多的惊喜和便利。