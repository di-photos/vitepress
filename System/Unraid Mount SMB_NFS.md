# Unraid 挂载 SMB/NFS 引发无法关机的解决思路

## 一、Unraid 挂载 SMB 场景

Unraid 挂载 SMB 在连接其他 NAS 系统、实现文件共享和数据备份同步等方面有着广泛的应用，为用户提供了更加便捷和高效的数据管理方式。

例如：

1. 可以将其他 NAS 系统中的媒体文件挂载到 Unraid 中，然后通过 Unraid 上的应用程序进行播放和管理。
2. 挂载 SMB 还可以用于数据备份和同步。用户可以将重要的数据存储在其他设备上，通过挂载 SMB 将数据备份到 Unraid 中，或者进行双向同步，确保数据的安全性和可用性。在实际应用中，根据不同的需求，可以选择不同的挂载方式和参数。例如，可以选择只读挂载或读写挂载，根据网络环境和数据安全性的要求进行设置。同时，还可以通过编写脚本来实现自动化挂载和卸载，提高工作效率。

Nasu开始使用群晖系统，积累了不少资料及影音文件，后来转为unraid后就使用Unassigned Devices umount 插件挂载虚拟群晖的文件使用。

## 二、挂载 SM B 后无法关机的问题及解决思路

当在 Unraid 系统中挂载群晖的 SMB 后，**关闭群晖虚拟机，没有预先卸载挂载文件夹**，unraid就会无法正常关机。一开始不清楚具体原因，只能采取强制关机的方式来关闭系统。

后来查看unraid的系统日记，发现此时Unassigned Devices umount 插件有异常记录就怀疑时卸载不正常造成的。

![](https://webp.nas-u.top/Nasu_241031144353.png)

**解决方法一：**

手动在 Unassigned Devices 卸载所有已经挂载的共享文件夹，unraid能正常关机。

**解决方法二：**

打开终端运行 “umount -l /mnt/remotes/* ”，强制卸载所有共享文件夹后也能正常关机，从而得到了进一步验证。

**解决方法三：**

上述两种方法都需要手动操作，显得繁琐。另外一种方法是通过Unassigned Devices umount 插件的Script来实现在unraid关机时自动化卸载 SMB 共享文件夹。

具体方法如下：

1）单击共享文件夹后面设置的齿轮，进入设置界面。

![](https://webp.nas-u.top/Nasu_241031145957.png)

2）在设置界面的最下部点击“**默认**”按钮加载配置。

![](https://webp.nas-u.top/Nasu_241031150350.png)

3）配置代码往下拉，在 'UNMOUNT' )位置插入下列代码“ umount -l /mnt/remotes/* ”卸载全部挂载的文件夹。或者每个挂载的文件夹都写入以上内容，而*就以具体挂载目录名称替代，同时进行保存。

![](https://webp.nas-u.top/Nasu_241031150819.png)

**解决方法四：**

当然也可以使用 “User Scripts” 插件，在阵列停止时执行卸载已挂载的共享文件夹。这个方法也略显繁琐，我就没执行，有兴趣的同学可以自行尝试。